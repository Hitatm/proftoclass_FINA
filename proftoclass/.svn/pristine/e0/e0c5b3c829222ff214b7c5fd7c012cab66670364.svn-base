lock=false;(function(d,e,f){var a=e.event,c;a.special.smartresize={setup:function(){e(this).bind("resize",a.special.smartresize.handler)},teardown:function(){e(this).unbind("resize",a.special.smartresize.handler)},handler:function(j,g){var i=this,h=arguments;j.type="smartresize";if(c){clearTimeout(c)}c=setTimeout(function(){jQuery.event.handle.apply(i,h)},g==="execAsap"?0:100)}};e.fn.smartresize=function(g){return g?this.bind("smartresize",g):this.trigger("smartresize",["execAsap"])};e.Mason=function(g,h){this.element=e(h);this._create(g);this._init();layBox.Mason=this;e(d).bind("scroll",layBox.pageLoad);(typeof(g)!="undefined"&&g.isRTL)?this.element.css("float","right"):"";if(e("#doLetter").length>0){e("#doLetter").bind("click",layBox.doLetter)}};e.Mason.settings={isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500},gutterWidth:0,isRTL:false,isFitWidth:false,h:0,containerStyle:{position:"relative"}};e.Mason.prototype={_filterFindBricks:function(h){var g=this.options.itemSelector;return !g?h:h.filter(g).add(h.find(g))},_getBricks:function(h){var g=this._filterFindBricks(h).css({position:"absolute",display:"hidden"}).addClass("masonry-brick");return g},updateItemdata:function(k,n,m){var i=n||layBox.options.pin_id;var j="pin_"+i;var m=m||e("#"+j).outerHeight(true);if(typeof(k.html)!="undefined"){if(typeof k.parent_id!="undefined"){e("#comment_info_"+k.parent_id).after(k.html)}else{if(e("#pin_comment_li_"+i).length>0){e("#pin_comment_li_"+i).before(k.html)}else{e("#likecomment_"+i).before(k.html)}}e("#comment_info_"+k.comment_id).hover(function(){var o=e(this).attr("data");e(this).find("#reply_comment_"+o).show().click(function(){var q=e(this).attr("data");var p=e(this).attr("replydata");e("#comment_"+q).attr("replydata",p);e("#comment_sumbit_"+q).attr("replydata",p);e("#comment_"+q).focus()})},function(){var o=e(this).attr("data");e(this).find("#reply_comment_"+o).hide().unbind("click")})}var g=e("#"+j).css(this.horizontalDirection);var h=e("#"+j).outerHeight(true);var l=h-m;this._reLayoutrow(g,j,l)},_reLayoutrow:function(q,j,k){var n=this.$bricks.length;var o=this.$bricks;var h=false;for(var l=0;l<n;l++){var m=e(o[l]);var g=m.attr("id");var p=m.css(this.horizontalDirection);if(h&&p==q){var s=m.css("top");var r=parseInt(s.replace("px",""))+k;m.animate({top:r},500)}if(typeof g!="undefined"&&g==j){h=true}}},_create:function(i){this.options=e.extend(true,{},e.Mason.settings,i);this.styleQueue=[];var h=this.element[0].style;this.originalStyle={height:h.height||""};var j=this.options.containerStyle;for(var k in j){this.originalStyle[k]=h[k]||""}this.element.css(j);this.horizontalDirection=this.options.isRTL?"right":"left";this.offset={x:parseInt(this.element.css("padding-"+this.horizontalDirection),10),y:parseInt(this.element.css("padding-top"),10)};this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth==="function";var g=this;setTimeout(function(){g.element.addClass("masonry")},0);if(this.options.isResizable){e(d).bind("smartresize.masonry",function(){layBox.setW();g.resize()})}this.reloadItems()},_init:function(g){this._getColumns();this._reLayout(g)},option:function(g,h){if(e.isPlainObject(g)){this.options=e.extend(true,this.options,g)}},layout:function(r,t){for(var o=0,q=r.length;o<q;o++){this._placeBrick(r[o])}var g={};g.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var l=0;o=this.cols;while(--o){if(this.colYs[o]!==0){break}l++}g.width=(this.cols-l)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:g});var j="css",k=this.options.animationOptions;if(k){if(!e.browser.msie){j="animate"}}var n;for(o=0,q=this.styleQueue.length;o<q;o++){n=this.styleQueue[o];if(n.$el.attr("id")=="container"&&j=="animate"){n.$el[j](n.style,k);var m=this.options.h||0;m=n.style.height+200+m}else{n.$el[j](n.style,k)}}var p=this.element.outerHeight(true)+this.element.next().height()+200;if(m){p=m}this.element.parent().height(p);var s=this.cols*this.columnWidth-4;this.element.parent().width(s);this.styleQueue=[];if(t){t.call(r)}this.isLaidOut=true},_getColumns:function(){var g=this.options.isFitWidth?this.element.parent():this.element,h=g.width();this.columnWidth=this.isFluid?this.options.columnWidth(h):this.options.columnWidth||this.$bricks.outerWidth(true)||h;this.columnWidth+=this.options.gutterWidth;this.cols=Math.floor((h+this.options.gutterWidth)/this.columnWidth);this.cols=Math.max(this.cols,1)},_placeBrick:function(q){var o=e(q),t,y,l,w,m;t=Math.ceil(o.outerWidth(true)/(this.columnWidth+this.options.gutterWidth));t=Math.min(t,this.cols);this.doEvent(o);if(t===1){l=this.colYs}else{y=this.cols+1-t;l=[];for(m=0;m<y;m++){w=this.colYs.slice(m,m+t);l[m]=Math.max.apply(Math,w)}}var h=Math.min.apply(Math,l),x=0;for(var n=0,s=l.length;n<s;n++){if(l[n]===h){x=n;break}}var p={top:h+this.offset.y};p[this.horizontalDirection]=this.columnWidth*x+this.offset.x;p["display"]="block";var g=this.options.specialId?this.options.specialId:"";if(g!=""&&layBox.options.page===1&&o.attr("id")==g){p[this.horizontalDirection]=this.columnWidth*(this.cols-1)+this.offset.x;x=this.cols-1;var u=o.find("div#category_parentall");u.find("a").css("display","block");var r=false;u.hover(function(){clearInterval(r)},function(){r=setInterval(function(){var i=u.find("a:first");var j=i.height();i.animate({marginTop:-j+"px"},1000,function(){i.css("marginTop",0).appendTo(u)})},3000)}).trigger("mouseleave")}this.styleQueue.push({$el:o,style:p});var v=h+o.outerHeight(true)+this.options.gutterWidth,k=this.cols+1-s;for(n=0;n<k;n++){this.colYs[x+n]=v}},resize:function(){var g=this.cols;this._getColumns();if(this.isFluid||this.cols!==g){this._reLayout()}},_reLayout:function(h){var g=this.cols;this.colYs=[];while(g--){this.colYs.push(0)}this.layout(this.$bricks,h)},_setSpecial:function(){var o=this.cols;var q=this.$bricks;var h=this.options.specialId;var u=q.length;var k=false;var r=false;for(var l=0;l<q.length;l++){var p=e(q[l]);var s=p.attr("id");if(s==h){k=p;r=l}}if(k&&r){var g=[];for(var m=0,v=0;m<q.length;m++,v++){if(m==o){g[v]=k;v++;g[v]=q[m]}else{if(e(q[m]).attr("id")!=h){g[v]=q[m]}}}this.$bricks=e(g)}},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(g){this.reloadItems();this._init(g)},appended:function(h,i,j){if(i){this._filterFindBricks(h).css({top:this.element.height()});var g=this;setTimeout(function(){g._appended(h,j)},1)}else{this._appended(h,j)}},_appended:function(g,i){var h=this._getBricks(g);this.$bricks=this.$bricks.add(h);this.element.append(g);this.layout(h,i)},remove:function(g){this.$bricks=this.$bricks.not(g);g.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="";this.style.top="";this.style.left=""});var g=this.element[0].style;for(var h in this.originalStyle){g[h]=this.originalStyle[h]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry");e(d).unbind(".masonry")},doEvent:function(g){g.hover(function(){e(this).addClass("current")},function(){e(this).removeClass("current")});var i=g.attr("id");if(g.find("#pin_image_190").length>0){g.find("#pin_image_190").click(layBox.doDetail)}if(g.find(".fwuser").length>0){g.find(".fwuser").bind("click",layBox.fwUser)}if(g.find(".FollowBoard").length>0){g.find(".FollowBoard a[id*=board_fw_]").bind("click",layBox.followBoard)}if(g.find("a[id^='pinban_']").length>0){g.find("a[id^='pinban_']").bind("click",layBox.doEditPinban)}if(g.find("ul li[id*=comment_info_]").length>0){g.find("ul li[id*=comment_info_]").hover(function(){var j=e(this).attr("data");e(this).find("#reply_comment_"+j).show().click(function(){var l=e(this).attr("data");var k=e(this).attr("replydata");e("#comment_"+l).attr("replydata",k);e("#comment_sumbit_"+l).attr("replydata",k);e("#comment_"+l).focus()})},function(){var j=e(this).attr("data");e(this).find("#reply_comment_"+j).hide().unbind("click")})}if(typeof i!="undefined"){var h=i.substr(i.indexOf("_")+1);g.find("#pinPic_"+h).bind("click",layBox.doCollection);g.find("#comment_"+h).focus(layBox.doComment);g.find("#comment_"+h).blur(function(){if(e.trim(e(this).val())==""){e(this).val("我来说两句...")}lock=false});g.find("#comment_sumbit_"+h).click(layBox.doSubmitComment);g.find("#like_"+h).bind("click",layBox.doLike);if(g.find("#commentBotton_"+h).length>0){e("#commentBotton_"+h).bind("click",layBox.doSetComment)}g.find("#fen_"+h).bind("click",layBox.dofenxiang)}}};
/*!
   * jQuery imagesLoaded plugin v1.1.0
   * http://github.com/desandro/imagesloaded
   *
   * MIT License. by Paul Irish et al.
   */
e.fn.imagesLoaded=function(n){var l=this,j=l.find("img").add(l.filter("img")),g=j.length,m="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i=[];function k(){n.call(l,j)}function h(p){var o=p.target;if(o.src!==m&&e.inArray(o,i)===-1){i.push(o);if(--g<=0){setTimeout(k);j.unbind(".imagesLoaded",h)}}}if(!g){k()}j.bind("load.imagesLoaded error.imagesLoaded",h).each(function(){var o=this.src;this.src=m;this.src=o});return l};var b=function(g){if(d.console){d.console.error(g)}};e.fn.masonry=function(h){if(typeof h==="string"){var g=Array.prototype.slice.call(arguments,1);this.each(function(){var i=e.data(this,"masonry");if(!i){b("cannot call methods on masonry prior to initialization; "+"attempted to call method '"+h+"'");return}if(!e.isFunction(i[h])||h.charAt(0)==="_"){b("no such method '"+h+"' for masonry instance");return}i[h].apply(i,g)})}else{this.each(function(){var i=e.data(this,"masonry");if(i){i.option(h||{});i._init()}else{e.data(this,"masonry",new e.Mason(h,this))}})}return this}})(window,jQuery);(function(a,b){b.layBox=function(c){this.options.hhs=[];this.options.toolID="";this.options.pin_id=null;this.options.is_login=c.is_login||false;this.options.len=0;this.options.items=[];this.options.user=c.user||false;this.options.flag="b";this.options.MSIE6=false;if(b.browser.version=="6.0"){this.options.MSIE6=true}this.options.token_key=c.token_key||"";this.options.w=0;this.options.b_w=0;this.options.page=1;this.options.ispage=true;this.options.is_pininfo=c.is_pininfo||false;this.options.uri=c.uri||a.location.href;this.options.h=c.h||0;this.options.isexe=false;this.options.sortable=c.sortable||false;this.options.access_user=c.access_user||false;this._init()};b.layBox.prototype={Mason:{},options:{},_init:function(){b("html").css("overflow-x","hidden");this.setW();b("#top_button").click(this.toTop);b(a).bind("scroll",this.showTop);b(a).bind("scroll",this.doQuite)},doQuite:function(){if(b("#quite_reg").length>0){var e=b("#quite_reg");var d=e.css("display");var f=b(document).scrollTop(),c=b(a).height();if(layBox.options.MSIE6){return}else{if(f>c*2&&d=="none"){e.show(80)}else{}}}},showTop:function(){var e=b(a).height();var h=b(a).scrollTop();var d=b("#top_button").css("display");if(h>0&&d=="none"){b("#top_button").show("fast")}else{if(h<=0){b("#top_button").hide()}}if(layBox.options.MSIE6){var g=b(document).scrollTop(),c=b(a).height();var f=c+g-b("#top_button").outerHeight()-40;b("#top_button").css("top",f+"px");b("#top_button").css("position","absolute")}},setW:function(){var c=b(a).width();var d=a.screen.width;if((c+21)>=d){c=d-21}var e=Math.floor((c+4)/226);var f=226*e-4;if(b("#personalInfo").length>0){b("#personalInfo").css("width",f+"px")}if(b(".PF_body").length>0){b(".PF_body").css("width",f+"px")}b(".header02").css("width",f+"px")},setCoverDiv:function(){var c=b(document).height();if(b("#coverDiv").length<=0){b("body").append('<div style="z-index: 102; position: absolute; top: 0px; left: 0px; height: '+c+"px; width:"+b(a).width()+'px; background: none repeat scroll 0% 0% rgb(255, 255, 255);" id="coverDiv"></div>')}b(a).unbind("scroll");b("#coverDiv").css({"opacity":0.88,"height":c,"width":b(a).width(),"display":"block"});if(b("#jsStyle").length<=0){layBox.doLoadByName("jsStyle",function(d){b("head").append(d)})}},closeCoverDiv:function(){var c=b(".fc-b-box").css("display");if(c=="none"){b("#coverDiv").hide()}},getPinfunCookie:function(e){if(layBox.options.user){return layBox.options.user}var c=this.getCookie("pinfun_user_id");var d=this.getCookie("pinfun_user_avatar");var f=this.getCookie("pinfun_user_name");if(c==""){return""}return{"user_id":c,"user_avatar":unescape(d),"user_name":f}},getCookie:function(g){var k=document.cookie;var e="";if(k.search("=")!=-1){if(k.search(";")!=-1){var j=k.split(";");var c=j.length;for(var f=0;f<c;f++){var h=j[f].split("=");if(g==b.trim(h[0])){e=h[1]}}}else{var d=k.split("=");if(g==b.trim(d[0])){e=d[1]}}}return e},doEditPinban:function(){var c=b(this).attr("id").split("_");var d=c[1];layBox.options.toolID="pinban";layBox.setDisplay("pinban",layBox.doClose,"&board_id="+d)},doShare:function(c){layBox.closeOper(c)},setToolstyle:function(j,i,h,c){var f=b("body").width()/2;var g=c||"fixed";var e=i||b("body").height()+500;var d=h||"50%";if(this.options.MSIE6){g="absolute";e=(b("body").height()/2)+"px"}b("#"+j).css({"display":"block","background":"#fff","z-index":153,"position":g,"top":e,"left":d,"opacity":"0"})},upSrcoll:function(i,e){b("#"+i).css("z-index",153);var g=b("#"+i).outerHeight();var d=b(a).height()/8;if(this.options.MSIE6){var f=b(document).scrollTop(),c=b(a).height();d=f+50}b("#"+i).animate({top:d,opacity:"1"},{duration:180})},doClose:function(d){var c=d||layBox.options.toolID;b("#"+c+" .close").bind("click",function(){var f=this;var e=c||b(this).parent().parent().parent().attr("id");layBox.closeTool(f,e,function(g){g.hide();layBox.closeCoverDiv();var h=b(f).parents("#"+c);layBox.setToolstyle(g.attr("id"));b("#"+c).remove();if(b("#imgcontainer").length>0){b("#imgcontainer").remove()}})})},closeTool:function(g,f,e){var c=b(g).parents("#"+f);var d=b(g).parents("#"+f);if(layBox.options.page%10!=0){b(a).bind("scroll",layBox.pageLoad)}d.animate({top:"-800px",opacity:"0"},{duration:180,complete:function(){e(c)}})},closeOper:function(f){var c=layBox.options.toolID||"toolbox";var d=b("#"+c);var e="";if(f){e=f.pin_id}layBox.options.toolID="share";d.animate({top:"-800px",opacity:"0"},{duration:180,complete:function(){layBox.setDisplay("share",layBox.doClose,"&pin_id="+e)}})},followBoard:function(){layBox.options.toolID="fwboard";if(!layBox.options.is_login){layBox.doLogin()}else{var d=b(this);d.find("strong").html("<img height='14' style='margin:0;' src='http://static.pinfun.com/images/common/loading.gif' />");var c=d.attr("data");b.ajax({type:"get",url:c,dataType:"json",success:function(e){if(e.status==1){if(e.o!=-1){d.html('<strong class="PF_textga">取消关注<u class="PF_fonta PF_textgc PF_fontwb PF_undernone">('+e.num+"人关注)</u></strong><span></span>")}else{d.html('<strong class="PF_textga">关&nbsp;&nbsp;注<u class="PF_fonta PF_textgc PF_fontwb PF_undernone">('+e.num+"人关注)</u></strong><span></span>")}}else{d.find("strong").html("<font color='red'>操作有误</font>")}},error:function(){}})}},fwUser:function(){layBox.options.toolID="fwuser";if(!layBox.options.is_login){layBox.doLogin();return false}else{var c=b(this);var d=c.find("strong").length>0?true:false;if(c.hasClass("Button_05")||c.hasClass("Button_05ed")){}else{if(d){c.find("strong").html("<img height='14' style='margin:0;' src='http://static.pinfun.com/images/common/loading.gif' />")}else{c.removeClass("attention");c.addClass("loading_01")}}b.ajax({url:c.attr("data"),dataType:"json",success:function(e){c.removeClass("loading_01");if(e==1){if(c.hasClass("Button_05")){c.removeClass("Button_05").addClass("Button_05ed")}else{if(d){c.find("strong").html("取消关注")}else{c.removeClass("attention").addClass("attention_qx");c.html("")}}}else{if(e==-1){if(c.hasClass("Button_05ed")){c.removeClass("Button_05ed").addClass("Button_05")}else{if(d){c.find("strong").html("关&nbsp;&nbsp;注")}else{c.removeClass("attention_qx").addClass("attention");c.html("")}}}}}})}return false},doCollection:function(){layBox.options.toolID="repin";var c=b(this).attr("data");layBox.options.pin_id=c;if(b("#comBtn_2012").length>0){b("#comBtn_2012").html("<button type='button'> <u>保存</u> </button>")}if(!layBox.options.is_login){var d=this;layBox.doLogin()}else{layBox.setDisplay("repin",function(){layBox.fetchPinData(c);layBox.doClose("repin")})}},doSetComment:function(){var d=b(this).attr("data");if(b("#pin_comment_li_"+d).length==0){var c='<li id="pin_comment_li_'+d+'" class="private Form01" style="diplay:none;">';c+='<p><textarea id="comment_'+d+'" data="'+d+'" replydata="">我来说两句...</textarea>';c+='<button class="sx_enter" id="comment_sumbit_'+d+'" replydata="" data="'+d+'">发送</button></p>';c+="</li>";var e=b("#pin_"+d).outerHeight(true);b("#pin_"+d+" > ul").append(c);layBox.Mason.updateItemdata({},d,e);lock=false;b("#comment_sumbit_"+d).click(layBox.doSubmitComment);b("#comment_"+d).focus(layBox.doComment);b("#comment_"+d).blur(function(){if(b.trim(b(this).val())==""){b(this).val("我来说两句...")}});b("#comment_"+d).bind("keydown",layBox.doSubmitComment)}b("#comment_"+d).focus()},doComment:function(){layBox.options.toolID="comment";var e=b(this).attr("data");var d=b(this).attr("replydata");var c="";if(typeof(d)!="undefined"&&d!=""){c="@"+b("#comment_user_"+d).val()+" "}else{c="@"+b("#pin_usernicename_"+e).val()+" "}layBox.options.pin_id=e;if(b.trim(b(this).val())=="我来说两句..."){b(this).val(c)}else{var f=b(this).val();if(f.search(c)==-1){c=c+b(this).val();b(this).val(c)}}return},fetchData:function(){layBox.options.ispage=false;this.setLoad();b.ajax({url:this.options.uri,type:"get",data:{"token_key":this.token_key,"page":++this.options.page,"category":this.options.cate},dataType:"html",success:function(e){var c=b.trim(e);if(c!=""){layBox.options.ispage=true;var d=b(e);layBox.Mason._appended(d,function(){layBox.doSortable()})}else{b("#loadingtip").hide();b("#loadingtip_more").html("<span>没有更多内容</span>");b("#loadingtip_more").show()}}})},doSortable:function(c){if(layBox.options.sortable==true&&layBox.options.is_login==true&&layBox.options.user.user_id==layBox.options.access_user.user_id){b("#container div.dashboard-item").removeClass("masonry-brick").removeAttr("style");b("#container").sortable({containment:b("#container"),cursor:"move",tolerance:"pointer",cancel:"a,button",placeholder:"dashboard-item",scroll:true,scrollSensitivity:100,sort:function(d,e){var f=b("#container").offset();e.item.css({"top":e.offset.top-f.top+"px","left":e.offset.left-f.left+"px"})},stop:function(d,e){var f="";b("#container > div.dashboard-item").each(function(){f+=b(this).attr("data")+"_"+b(this).index()+","});b.ajax({url:"/board/sort",type:"post",data:{board_sorts:f},dataType:"json",success:function(g){}})}});b("#container").disableSelection()}return true},doClickPage:function(){b("#loadingtip").show("fast");b("#loadingtip_more").hide();layBox.fetchData()},setLoad:function(){var d=b("#loadingtip");var c=d.css("display");if(c=="none"){d.show("fast")}},pageLoad:function(){var d=b("#container").height();var c=b(a).height();var e=b(a).scrollTop();if(e+c>d+100&&layBox.options.page%10!=0&&layBox.options.ispage){layBox.setLoad()}if(e+c>d+110&&layBox.options.page%10!=0&&layBox.options.ispage){layBox.fetchData()}if(layBox.options.page%10==0){b("#loadingtip_more").show();b("#loadingtip").hide()}else{if(layBox.options.ispage){b("#loadingtip_more").hide();b("#loadingtip").show()}}},doDetail:function(q){q.preventDefault();if(layBox.options.isexe){return}layBox.options.isexe=true;var v=b(document).scrollTop();var r=b(".PF_body").height()+400;var h=b(this);var t=h.attr("data");var k=t.substr(0,t.search(","));var f=t.substr(t.search(",")+1);var u=b(".fc-b-box .fc-b-img img");var d=h.find("img");var c=b(d[0]);u.attr("src",f);u.attr("alt",c.attr("alt"));u.attr("title",c.attr("alt"));var m=b(".fc-b-box .fc-b-img p[class!=fc-b-img-img]");b(m[0]).html(c.attr("alt"));var j=b("#pin_"+k).prev();var n=b("#pin_"+k).next();if(j.length>0){var s=b(j[0]).attr("id");if(s){b(".fc-b-box .fc-b-img .fc-img-img-l").attr("data",s.replace("pin_",""));b(".fc-b-box .fc-b-img .fc-img-img-l").click(layBox.doPage)}}if(n.length>0){var e=b(n[0]).attr("id");if(e){b(".fc-b-box .fc-b-img .fc-img-img-r").attr("data",e.replace("pin_",""));b(".fc-b-box .fc-b-img .fc-img-img-r").click(layBox.doPage)}}b(".fc-b-box").css("display","block");var g=b(".fc-b-box").width();var o=(b(a).width()-g)/2;b(".fc-b-box").css({position:"absolute","z-index":105,top:30,left:o});var i=b(document).height();if(b("#coverDiv").length<=0){b("body").append('<div style="z-index: 102; position: absolute; top: 0px; left: 0px; height: '+i+"px; width:"+b(a).width()+'px;background-color:rgba(255, 255, 255, 0.93);" id="coverDiv"></div>')}if(b.browser.msie){b("#coverDiv").css("background","#ffffff")}b("#coverDiv").css({"opacity":0.88,"height":i,"width":b(a).width(),"display":"block"});b("#coverDiv").click(function(){b("body").css("overflow","");b("body").height(r);b("html").height(r);b(document).height(r);b("#coverDiv").hide();b(".fc-b-box .fc-b").remove();b(".fc-b-box #detail_comment").remove();b(".fc-b-box #fc-b-tl").remove();b(".fc-b-box #detail_like").remove();b(".fc-b-box #detail_repin").remove();b(".fc-b-box #detail_pin").remove();b(".fc-b-box #comments_list").remove();b(".fc-b-box #oper_list_detail").remove();var l=0;b(".fc-b-box .fc-b-img-img img").each(function(){if(l!=0){b(this).remove()}else{b(this).attr("src","#")}l++});b(".fc-b-box").hide();b(document).scrollTop(v);layBox.options.isexe=false});b("body").css("overflow","hidden");b.ajax({url:"/fetch/photo/"+k,type:"get",dataType:"json",success:function(p){b(document).scrollTop(0);if(p.user){b(".fc-b-box").prepend(p.user)}if(p.comment){b(".fc-b-box").append(p.comment)}if(p.pin){b(".fc-b-box").append(p.pin)}if(p.repin){b(".fc-b-box").append(p.repin)}if(p.like){b(".fc-b-box").append(p.like)}if(p.images){b(".fc-b-box .fc-b-img-img").append(p.images)}b(".fc-b-box .fc-b-img-img img").bind("load",function(){var w=b(".fc-b-box").outerHeight(true);b("#coverDiv").height(w+10);b("html").height(w+10);b("body").height(w+10)});b(m[0]).append(p.oper);var l=b(".fc-b-box").outerHeight(true);b("#coverDiv").height(l+10);b("html").height(l+10);b("body").height(l+10)}})},doPage:function(){if(layBox.options.isexe){layBox.options.isexe=false;b(".fc-b-box .fc-b").remove();b(".fc-b-box #detail_comment").remove();b(".fc-b-box #fc-b-tl").remove();b(".fc-b-box #detail_like").remove();b(".fc-b-box #detail_repin").remove();b(".fc-b-box #detail_pin").remove();b(".fc-b-box #comments_list").remove();b(".fc-b-box #oper_list_detail").remove();var k=0;b(".fc-b-box .fc-b-img-img img").each(function(){if(k!=0){b(this).remove()}else{b(this).attr("src","#")}k++});var e=b(this).attr("data");var l=b("#pin_"+e+" #pin_image_190");var h=l.attr("data");var e=h.substr(0,h.search(","));var c=h.substr(h.search(",")+1);var i=b(".fc-b-box .fc-b-img img");var f=l.find("img");var n=b(f[0]);i.attr("src",c);i.attr("alt",n.attr("alt"));i.attr("title",n.attr("alt"));b(".fc-b-box .fc-b-img").prepend('<span id="pin_info_loading_text">加载中</span><img src="http://static.pinfun.com/images/common/pfld.gif" id="pin_info_loading_img"/>');var d=b(".fc-b-box .fc-b-img p[class!=fc-b-img-img]");b(d[0]).html(n.attr("alt"));var g=b("#pin_"+e).prev();var j=b("#pin_"+e).next();if(g.length>0){var o=b(g[0]).attr("id");if(o){b(".fc-b-box .fc-b-img .fc-img-img-l").attr("data",o.replace("pin_",""))}}else{b(".fc-b-box .fc-b-img .fc-img-img-l").unbind("click",layBox.doPage)}if(j.length>0){var m=b(j[0]).attr("id");if(m){b(".fc-b-box .fc-b-img .fc-img-img-r").attr("data",m.replace("pin_",""))}}else{b(".fc-b-box .fc-b-img .fc-img-img-r").unbind("click",layBox.doPage)}b.ajax({url:"/fetch/photo/"+e,type:"get",dataType:"json",success:function(q){layBox.options.isexe=true;b(document).scrollTop(0);b(".fc-b-box .fc-b-img #pin_info_loading_img").remove();b(".fc-b-box .fc-b-img #pin_info_loading_text").remove();if(q.user){b(".fc-b-box").prepend(q.user)}if(q.comment){b(".fc-b-box").append(q.comment)}if(q.pin){b(".fc-b-box").append(q.pin)}if(q.repin){b(".fc-b-box").append(q.repin)}if(q.like){b(".fc-b-box").append(q.like)}if(q.images){b(".fc-b-box .fc-b-img-img").append(q.images)}b(".fc-b-box .fc-b-img-img img").bind("load",function(){var r=b(".fc-b-box").outerHeight(true);b("#coverDiv").height(r+10);b("html").height(r+10);b("body").height(r+10)});b(d[0]).append(q.oper);var p=b(".fc-b-box").outerHeight(true);b("#coverDiv").height(p+10);b("html").height(p+10);b("body").height(p+10)}})}},doCancelComment:function(){var c=layBox.options.pin_id;b("#comment_"+c).unbind("keydown");return},getStringlen:function(c){return c.replace(/[^\x00-\xff]/g,"**").length},doSubmitComment:function(j){if(lock){return}lock=true;var g=j.which;if(g==13||g==1||g==0){layBox.options.toolID="comment";j.preventDefault();j.stopPropagation();var k=b(this).attr("data");var f=b(this).attr("replydata");if(typeof(f)=="undefined"){f=""}layBox.options.pin_id=k;var d=layBox.getPinfunCookie();if(!layBox.options.is_login){layBox.doLogin();lock=false;return}var h="/pin/"+k+"/comment/";var c=b.trim(b("#comment_"+k).val());var i=3;if(b("#comment_body").length>0||c==""){c=b.trim(b("#comment_body").val());if(c==""){c=b.trim(b("#comment_body_"+k).val())}i=1}b("#comment_"+k).val("我来说两句...");if(c==""||c=="我来说两句..."){alert("请输入评论的内容!!");b("#comment_"+k).focus()}else{if(layBox.getStringlen(c)>300){alert("评论内容不能过多!");b("#comment_"+k).focus()}else{if(i==1){if(b("#commentsend_"+k).length>0){b("#commentsend_"+k).unbind("click");b("#commentsend_"+k).find("button > u").html("提交中")}else{b("#commentsend").unbind("click");b("#commentsend").find("button > u").html("提交中")}}b.ajax({url:h,type:"post",dataType:"json",data:{"comment_body":c,"parent_id":f,"info":i},success:function(l){lock=false;if(typeof l.error!="undefined"){if(l.error==2){alert(l.msg);if(i==3){b("#comment_"+k).attr("replydata","");b("#comment_sumbit_"+k).attr("replydata","")}return}else{if(l.error==1){return}}}if(i==3){if(b("#comment_"+k).length>0){layBox.Mason.updateItemdata(l,k)}if(b("#pin_comment_total_"+k).length>0){var e=parseInt(b("#pin_comment_total_"+k).html().replace("<em>评论</em>",""));e+=1;b("#pin_comment_total_"+k).html(e+"<em>评论</em>")}}else{if(i==1){var m=b("#comments_list").css("display");if(m=="none"){b("#comments_list").show()}if(b("#comments_list ul").length<=0){b("#comments_list").append('<ul id="comments" class="pdcomments_hf pinlist">'+l.html+"</ul>")}else{b("#comments_list ul").prepend(l.html)}a.layBox.commentHover();b("#comment_body").val("");if(b("#commentsend_"+k).length>0){b("#commentsend_"+k).bind("click",a.layBox.doSubmitComment);b("#commentsend_"+k).find("button > u").html("评论")}else{b("#commentsend").bind("click",a.layBox.doSubmitComment);b("#commentsend").find("button > u").html("评论")}b("#comments a[id^='comment_control_del_']:first").bind("click",a.layBox.doDeleteComment);operate.updateNum()}else{}}}})}}}},doDeleteComment:function(){var e=b(this).attr("data").split("_");var d=parseInt(e[0]);var c=parseInt(e[1]);if(!isNaN(d)&&!isNaN(c)){b("#comment_"+c).slideUp("fast",function(){b.ajax({url:"/pin/"+d+"/comment/del",type:"post",data:{"comment_id":c},dataType:"json",success:function(f){b("#comment_"+c).remove()}})})}else{alert("删除失败，稍后重试")}},commentHover:function(){b("#comments > li[id^='comment_']").each(function(){b(this).hover(function(){var c=this.id.substr(this.id.indexOf("_")+1);b("#comment_control_del_"+c).show();b("#comment_control_reply_"+c).show()},function(){var c=this.id.substr(this.id.indexOf("_")+1);b("#comment_control_del_"+c).hide();b("#comment_control_reply_"+c).hide()})});if(b("div[id^=comment_]").length>0){b("div[id^=comment_]").each(function(){b(this).hover(function(){var c=this.id.substr(this.id.indexOf("_")+1);b("#comment_control_del_"+c).show()},function(){var c=this.id.substr(this.id.indexOf("_")+1);b("#comment_control_del_"+c).hide()})})}},doLike:function(){layBox.options.toolID="like";var c=b(this).attr("data");layBox.options.pin_id=c;if(!layBox.options.is_login){var d=this;layBox.doLogin()}else{layBox.doSumbitLike()}},doLogin:function(){layBox.setCoverDiv();layBox.setDisplay("ajaxlogin",function(){layBox.doClose("ajaxlogin")},"")},doLoadByName:function(c,f,e){var d=e||"";if(b("#"+c).length<=0){b.ajax({url:"/pin/tools/",dataType:"json",data:"action="+c+d,type:"POST",success:function(g){f(g)}})}else{return false}},doSumbitLike:function(){var c=this.getPinfunCookie();layBox.doShowheart();if(c==""){this.doLogin()}else{if(this.doCheckuser(c.user_id)){alert("您不能对自己的拼图发起此操作!");this.closeCoverDiv();return}else{var d="/pin/"+this.options.pin_id+"/like/";b.ajax({url:d,type:"post",dataType:"json",success:function(f){if(!f){return}var i=b("#comments_list").length;if(b("#pin_like_num_"+layBox.options.pin_id).length>0){var h=parseInt(b("#pin_like_num_"+layBox.options.pin_id).html().replace("<em>喜欢</em>",""));h+=1;b("#pin_like_num_"+layBox.options.pin_id).html(h+"<em>喜欢</em>");b("#like_"+layBox.options.pin_id).unbind("click");b("#like_"+layBox.options.pin_id+" > i").removeClass("PF_icon105").addClass("PF_icon44")}else{if(i>0){b("#pinLike > em").removeClass("PF_icon105").addClass("PF_icon44");if(b(".pcbottom_like").length>0){b(".pcbottom_like").append(f.html)}else{var e='<div class="pcbottom_like"sytle="display:none;"><h2 class="PF_fontc PF_textgc">这些人喜欢</h2>';e+=f.html;e+="</div>";b("#comments_list").after(e);b(".pcbottom_like").slideDown(100)}}}if(i>0){if(b("#pin_detail_like_oper").length>0){b("#pin_detail_like_oper").removeClass("pc-xh").addClass("pc-xhed");b("#pin_detail_like_oper").unbind("click");if(b("#detail_like").length>0){b("#detail_like h2").after(f.html)}else{var g='<div class="fc-b-like pcbottom_like" id="detail_like">';g+="<h2><span>这些人喜欢该作品</span></h2>";g+=f.html;g+="</div>";b("#fc-b-tl").after(g)}}}}})}}},doCheckuser:function(c){var d=b("#pin_user_"+this.options.pin_id).val();if(d==c){return true}else{return false}},dofenxiang:function(){layBox.options.toolID="fenxiang";var c=b(this).attr("data");layBox.options.pin_id=c;layBox.setDisplay("fenxiang",layBox.doClose,"&pin_id="+c)},doLetter:function(){layBox.options.toolID="perletter";if(layBox.options.is_login==false){layBox.doLogin();return false}layBox.setDisplay("perletter",layBox.doClose,"&whom_user_login_name="+b(this).attr("data"));return false},doShowheart:function(){var i="heart_"+layBox.options.pin_id;if(b("#"+i).length>0){b("#"+i).remove();return}var d="pin_"+layBox.options.pin_id;var l="heart_"+layBox.options.pin_id;var f=b("#"+d+" a img");var o=f.width();var j=f.height();var n=(o-104)/2;var m=(j<104)?0:(j-104)/8;var k=o-30;var g=(j<30)?0:(j-30);var c='<div id="heart_'+layBox.options.pin_id+'" style="background:none no-repeat scroll 0 0 transparent;width:104px;height:90px;position:absolute;top:'+m+"px;left:"+n+'px;"></div>';b("#"+d).children(".image").append(c);var e='<object width="115" height="100" class="swfupload" data="/flash/like.swf" type="application/x-shockwave-flash" id="like_o">';e+='<param value="transparent" name="wmode">';e+='<param value="/flash/like.swf" name="movie">';e+='<param value="high" name="quality">';e+='<param value="false" name="menu">';e+='<param value="" name="flashvars">';e+='<param value="always" name="allowScriptAccess">';e+='<param name="allowFullScreen" value="true">';e+='<param name="AllowNetworking" value="all">';e+="</object>";b("#"+i).append(e);setTimeout('$("#'+i+'").remove();',5000)},fetchPinData:function(c){b.ajax({type:"post",url:"/pinalt/"+c+"/repin/1",dataType:"json",success:function(q){b("#repin_pic").attr("src",q.imgurl);b(".DescriptionTextarea").text(q.pin_content);b("#pin_root").val(q.pin_root);b("#pin_from").val(c);b("#pin_image").val(q.pin_image);var p=q.boards.length;var k=q.boards;var n=q.cates;var j=n.length;var e="";var m="";b("#categoryList").empty();m+='<option value="">选择拼板类别</option>';for(var t=0;t<j;t++){m+='<option value="'+n[t].category_id+'">'+n[t].category_name+"</option>"}b("#categoryList").html(m);if(p>0){var s="";var v="";var h="";var g="";for(var o=0;o<p;o++){if(q.pin_board_id==k[o].board_id){s=k[o].board_title;v=k[o].board_id}if(q.pin_board_prev_id==k[o].board_id){h=k[o].board_title;g=k[o].board_id}e+='<dd value="'+k[o].board_id+'" onclick="doSelectBoard(\''+k[o].board_id+"','"+k[o].board_title+"');\" >"+k[o].board_title+"</dd>"}if(layBox.options.toolID=="pintu"){b("#create_select_fist").html(s);b("#repin_board_id").val(v)}else{if(h==""){h=k[0].board_title;g=k[0].board_id}b("#create_select_fist").html(h);b("#repin_board_id").val(g)}var f="";if(q.OAUTH_SOURCE_SINA){f+="<input checked onclick=\"pin_rsync_source_lc('"+q.OAUTH_SOURCE_SINA+'\');" type="checkbox" class="input_top" value="'+q.OAUTH_SOURCE_SINA+'"/><label for="sina_chk"> <img  src="http://static.pinfun.com/images/common/PF_trans.gif"  class="PF_icon PF_icon04"  alt="同时添加到新浪微博" title="同步到新浪微博"  align="absmiddle"  width="20"  height="20"></label>'}if(q.OAUTH_SOURCE_TENCENT){f+="<input checked onclick=\"pin_rsync_source_lc('"+q.OAUTH_SOURCE_TENCENT+'\');"  type="checkbox" class="input_top" value="'+q.OAUTH_SOURCE_TENCENT+'"/><label for="qq_chk"> <img  src="http://static.pinfun.com/images/common/PF_trans.gif"  class="PF_icon PF_icon06"  alt="同时添加腾讯浪微博" title="同步到腾讯微博"  align="absmiddle"  width="20"  height="20"></label>'}if(q.OAUTH_SOURCE_RENREN){f+="<input checked onclick=\"pin_rsync_source_lc('"+q.OAUTH_SOURCE_RENREN+'\');"  type="checkbox" class="input_top" value="'+q.OAUTH_SOURCE_RENREN+'"/><label for="renren_chk"> <img  src="http://static.pinfun.com/images/common/PF_trans.gif"  class="PF_icon PF_icon07"  alt="同时添加到人人网" title="同时添加到人人网"  align="absmiddle"  width="20"  height="20"></label>'}b("#tongbu2012_up").html(f);b("#boardList").html(e)}else{b("#create_select_fist").html("创建拼板")}var r=q.pin_label;if(r!=null){if(r.search(",")!=-1){var l=r.split(",");var d="";for(var u in l){d+='<span class="hover _j_label_item">';d+='<span class="suggest_item _j_richInputItem">';d+="<span>"+l[u]+"</span>&nbsp;";d+='<a href="javascript:;" class="spr_icons i_close_s _j_label_del" title="删除">x</a>';d+="</span>";d+="</span>"}}else{d='<span class="hover _j_label_item">';d+='<span class="suggest_item _j_richInputItem">';d+="<span>"+r+"</span>&nbsp;";d+='<a href="javascript:;" class="spr_icons i_close_s _j_label_del" title="删除">x</a>';d+="</span>";d+="</span>"}b("#trcklabels").html(d);b("._j_label_del").click(function(){b(this).parent().parent().remove()})}if(b("#pin_content_2012_lc").val()!=""&&b("#pin_content_2012_lc").val()!="填写作品描述…"){b.ajax({url:"/pin/fen",data:{"fen":b("#pin_content_2012_lc").val()},dataType:"html",type:"POST",success:function(i){var w="<p class='txt _j_placeholder'>添加标签，多个标签用空格隔开</p>";b("#checkLable").html(w+i);_lable()}})}}})},setDisplay:function(c,g,f){var d=b(a).height();d=d/4;layBox.setCoverDiv();if(!layBox.doLoadByName(c,function(i){b("body").append(i);var h=b(a).width()/2-b("#"+c).outerWidth()/2;layBox.setToolstyle(c,500,h,"fixed");layBox.upSrcoll(c,d);g()},f)){var e=b(a).width()/2-b("#"+c).outerWidth()/2;layBox.setToolstyle(c,-800,e,"fixed");layBox.upSrcoll(c,d);g()}},getOffsetTop:function(d){var c=d.offsetTop;while(d=d.offsetParent){c+=d.offsetTop}return c},getOffsetLeft:function(d){var c=d.offsetLeft;while(d=d.offsetParent){c+=d.offsetLeft}return c},toTop:function(c){c.stopPropagation();b("html, body").animate({scrollTop:0},120)},doEditBoard:function(c){if(b("#categoryList").val()==""||b("#categoryList").val()==0){alert("请选择拼板类别！");return}b.ajax({type:"post",url:b(c).attr("data"),timeout:"30000",data:b("#boardForm").serialize(),beforeSend:function(){},dataType:"json",success:function(d){if(d.error){alert("保存数据失败，稍后重试")}else{b("#coverDiv,#pinban").remove();b("#board_"+d.board_id+" > ul > li > .PF_fontb").html(d.board_title);b("#a_"+d.board_id).attr("href","/"+d.user_login_name+"/"+d.board_alias+"?t="+d.board_create_time);b("#pinban_"+d.board_id).closest("div").next("div").find(".ban_ms").html(d.board_description);alert("保存成功")}}})},doDelBoard:function(c){if(confirm("确认要删除影集吗？")){b.ajax({type:"get",url:b(c).attr("data"),timeout:"30000",data:"",beforeSend:function(){},dataType:"json",success:function(d){if(d.error){alert("删除失败")}else{b("#coverDiv,#pinban,#board_"+d.board_id).remove();if(b("a[id^='pinban_']").length<=1){location.href="/"+d.user_login_name+"/board"}b("#container").masonry("reload")}}})}},bigImage:function(){if(b("a[rel=image_group]").length<=0){return false}b("a[rel=image_group]").fancybox({"autoScale":false,"titlePosition":"inside","width":100,"scrolling":"auto","overlayShow":true,"overlayColor":"#fff","overlayOpacity":0.7,"hideOnOverlayClick":false,"showNavArrows":true,"cyclic":true,"transitionIn":"none","transitionOut":"none","titlePosition":"over","titleFormat":function(f,e,c,d){},"onComplete":function(f,d,e){var c=parseInt(b(document).width())-parseInt(b(document).width()/10);b("#fancybox-wrap").css("max-width",c+"px");b("#fancybox-img").css({"max-width":(c-20)+"px","height":"auto"});b.fancybox.center(true);return true}});return false},atMoney:function(){var c=b("#comment_body");return false},atFriend:function(){if(!b.fn.atWho){a.layBox.loadUrlfile("/flash/js/jquery_at/jquery.atwho.min.js","js");a.layBox.loadUrlfile("/flash/js/jquery_at/jquery.caret.min.js","js")}b.ajax({type:"post",url:"/pf/mention",data:"is_json=1",dataType:"json",success:function(c){if(c.length>0){var e=b.map(c,function(g,f){return{"id":f,"name":g.user_nice_name,"avatar":g.user_avatar}});var d="<li id='${id}' data-value='${name}' class='dummy'>"+"<p class='PF_floatl atwhohead'><img class='head_p' src='${avatar}'></p><p class='PF_floatl atwhoname'>${name}</p>"+"<p class='weibo'><img width='20' height='20' align='absmiddle' title='' alt='' class='PF_icon PF_icon28 PF_floatl' src='http://static.pinfun.com/images/common/PF_trans.gif'></p></li>";b("textarea#comment_body").atWho("@",{tpl:d,data:e});b("#atfriend").bind("click",function(){setTimeout(function(){b("#smiley_box").hide();var f=b("#comment_body").val().replace("我来说两句...","");b("#comment_body").keydown().val(f+" @").keyup()},300)})}}})},loadUrlfile:function(d,e){switch(e){case"js":var f=document.createElement("script");f.setAttribute("type","text/javascript");f.setAttribute("src",d);document.body.appendChild(f);break;case"css":var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("href",d);document.head.appendChild(c);break}return true},userDialog:function(){if(layBox.options.is_login==true){if(a.Mypanel_left==undefined||a.Mypanel_left!=true){var k=document.createElement("link");k.setAttribute("rel","stylesheet");k.setAttribute("type","text/css");k.setAttribute("href","http://static.pinfun.com/css/conf/Mypanel_left.css");a.Mypanel_left=true}var g=b(this);var c=b(document).scrollTop()+40;var d=b(document).scrollLeft();var j=g.offset().top;var l=g.offset().left;var f=g.height();var e=g.width();var i=g.attr("dialog")||"";if(i==""){return false}var h=b("div#dialog_"+i);if(h.length<=0){b("body").append('<div id="dialog_'+i+'" class="W_layer" style="display:none;"><div class="W_layer_bg"><div class="W_layer_box">加载中...</div></div></div>');h=b("div#dialog_"+i);b.ajax({url:"/dialog",type:"post",data:{"user_login_name":i},dataType:"html",success:function(m){h.find("div.W_layer_box").html(m);b("#fwuser_"+i).bind("click",a.layBox.fwUser);b("#doLetter_"+i).bind("click",a.layBox.doLetter)}})}h.css({"z-index":99,"position":"absolute"});h.find("div[class^='o_03']").remove();if(j-c>h.height()&&l+h.width()<b("body").width()){j=j-h.height()-0;l=l;h.css({"top":j+"px","left":l+"px"})}else{if(l>h.width()){j=j;l=l-h.width()-0;h.css({"top":j+"px","left":l+"px"})}else{if(l<h.width()){j=j;l=l+e+0;h.css({"top":j+"px","left":l+"px"})}else{j=j+f+0;l=l;h.css({"top":j+"px","left":l+"px"})}}}h.show("fast",function(){b("body").mouseover(function(m){h.hide()});h.mouseover(function(m){m.stopPropagation()})})}},cameraDialog:function(){var f=b(this);var c=f.find("div.photo-fc:first");if(c.is(":hidden")){var d=c.prev("div.icon-pt01:first");var e=parseInt(d.offset().top)-b("#container").offset().top+parseInt(d.height());c.css("top",e+"px").show("fast",function(){b("body").mouseover(function(g){c.hide()});c.mouseover(function(g){g.stopPropagation()})})}}};b.fn.pfBox=function(c){a.layBox=new b.layBox(c);if(layBox.options.is_pininfo==true){b("#pinPic").bind("click",a.layBox.doCollection);b("#pinLike").bind("click",a.layBox.doLike);b(".fwuser").bind("click",a.layBox.fwUser);b("#doLetter").bind("click",a.layBox.doLetter);if(b("#fwuser").length>0){b("#fwuser").bind("click",a.layBox.fwUser)}b("#commentsend").bind("click",a.layBox.doSubmitComment);b("#comments a[id^='comment_control_del_']").bind("click",a.layBox.doDeleteComment);b("#atmoney").bind("click",a.layBox.atMoney);a.layBox.bigImage();a.layBox.commentHover();a.layBox.atFriend()}b("#PF_body img.head_p[dialog!='']").live("mouseover",a.layBox.userDialog);b("div.xj_photo").live("mousemove",a.layBox.cameraDialog);b("li[id^='a_reply_']").click(layBox.doDetail);return a.layBox}})(window,jQuery);